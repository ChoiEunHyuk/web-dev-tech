## **🔹 트리거(Trigger)와 시퀀스(Sequence)란?**

트리거(Trigger)와 시퀀스(Sequence)는 **데이터베이스에서 자동으로 실행되는 기능**입니다.

둘 다 데이터 무결성을 유지하고, 반복적인 작업을 자동화하는 데 도움을 줍니다.

---

## **🔹 1. 트리거(Trigger)란?**

- *트리거(Trigger)**는 특정 **이벤트(INSERT, UPDATE, DELETE)**가 발생했을 때 **자동으로 실행되는 SQL 구문**입니다.

즉, 데이터 변경이 일어날 때 **자동으로 실행되는 데이터베이스 객체**입니다.

---

### **✅ 트리거의 특징**

1. **자동 실행**:
    - 특정 이벤트(INSERT, UPDATE, DELETE)가 발생하면 자동 실행됨.
    - 사용자가 직접 실행할 필요 없음.
2. **데이터 무결성 유지**:
    - 특정 조건에서 데이터를 자동으로 검증하거나 변경 가능.
    - 예: 급여(Salary)가 0보다 작으면 자동으로 막음.
3. **로그 기록 또는 감사(Auditing) 기능**:
    - 특정 테이블에서 데이터가 변경될 때, 이를 별도의 로그 테이블에 기록할 수 있음.

---

### **✅ 트리거 기본 문법**

```sql

CREATE TRIGGER 트리거_이름
BEFORE | AFTER INSERT | UPDATE | DELETE
ON 테이블_이름
FOR EACH ROW
BEGIN
    -- 실행할 SQL 구문
END;

```

📌 **설명**

- `BEFORE INSERT`: 데이터 삽입 전에 실행
- `AFTER INSERT`: 데이터 삽입 후에 실행
- `BEFORE UPDATE`: 데이터 업데이트 전에 실행
- `AFTER UPDATE`: 데이터 업데이트 후에 실행
- `BEFORE DELETE`: 데이터 삭제 전에 실행
- `AFTER DELETE`: 데이터 삭제 후에 실행

---

### **✅ 트리거 예제**

### **1. 직원 급여(Salary) 업데이트 시 로그 기록하는 트리거**

```sql

CREATE TABLE salary_log (
    log_id INT AUTO_INCREMENT PRIMARY KEY,
    emp_id INT,
    old_salary DECIMAL(10,2),
    new_salary DECIMAL(10,2),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TRIGGER salary_update_trigger
AFTER UPDATE ON employees
FOR EACH ROW
BEGIN
    INSERT INTO salary_log (emp_id, old_salary, new_salary)
    VALUES (OLD.id, OLD.salary, NEW.salary);
END;

```

📌 **설명**

- 직원 테이블에서 `salary`가 변경되면, 변경 전(old_salary)과 변경 후(new_salary)의 데이터를 `salary_log` 테이블에 기록하는 트리거.

---

### **2. 새로운 직원 등록 시 초기 급여 설정**

```sql

CREATE TRIGGER set_initial_salary
BEFORE INSERT ON employees
FOR EACH ROW
BEGIN
    IF NEW.salary IS NULL THEN
        SET NEW.salary = 3000000;  -- 기본 급여 설정 (300만 원)
    END IF;
END;

```

📌 **설명**

- `employees` 테이블에 새로운 직원이 추가될 때, 급여 값이 없으면 기본값(3,000,000)을 자동으로 설정함.

---

MySQL에서는 `AUTO_INCREMENT`, Oracle 및 PostgreSQL에서는 `SEQUENCE`를 사용합니다.

---

### **✅ 시퀀스의 특징**

1. **자동 증가(Auto Increment)**
    - 고유한 숫자 값(PK)을 자동으로 증가시켜 데이터 삽입 시 충돌을 방지함.
2. **중복 방지**
    - 시퀀스를 사용하면 수동으로 증가 값을 설정할 필요 없이 자동으로 관리됨.
3. **다른 테이블에서도 사용 가능**
    - 하나의 시퀀스를 여러 테이블에서 공유할 수 있음.

---

### **✅ 시퀀스 사용법 (Oracle, PostgreSQL)**

```sql

CREATE SEQUENCE user_seq
START WITH 1
INCREMENT BY 1
NOCACHE;

```

📌 **설명**

- `START WITH 1` → 1부터 시작
- `INCREMENT BY 1` → 1씩 증가
- `NOCACHE` → 캐시 사용 안 함 (기본적으로 시퀀스는 메모리에서 일정 숫자를 미리 할당하여 속도를 높임)

---

### **✅ 시퀀스 값 가져오기**

```sql

INSERT INTO users (id, name) VALUES (NEXTVAL('user_seq'), 'Alice');

```

📌 **설명**

- `NEXTVAL('user_seq')` → `user_seq` 시퀀스에서 다음 값을 가져옴.

---

### **✅ 시퀀스 삭제**

```sql
sql
복사편집
DROP SEQUENCE user_seq;

```

- 시퀀스를 삭제할 때 사용.

---

### **✅ MySQL에서 시퀀스 대신 `AUTO_INCREMENT` 사용**

MySQL은 별도의 `SEQUENCE` 객체를 제공하지 않고, `AUTO_INCREMENT`를 사용함.

```sql
sql
복사편집
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100)
);

```

📌 **설명**

- `AUTO_INCREMENT`를 설정하면, `id`가 자동으로 증가함.

---

## **🔹 트리거 vs 시퀀스 비교**

| **구분** | **트리거(Trigger)** | **시퀀스(Sequence)** |
| --- | --- | --- |
| **목적** | 특정 이벤트 발생 시 자동 실행 | 고유한 증가 값 자동 생성 |
| **실행 시점** | INSERT, UPDATE, DELETE 이벤트 발생 시 | NEXTVAL 호출 시 |
| **주요 기능** | 데이터 무결성 유지, 로깅, 자동 업데이트 | 기본 키(PK) 자동 증가 |
| **사용 예시** | 급여 변경 시 로그 기록, 기본값 자동 설정 | 사용자 ID, 주문 번호 자동 증가 |
| **DBMS 지원** | MySQL, Oracle, PostgreSQL 등 | Oracle, PostgreSQL (MySQL은 `AUTO_INCREMENT`) |

---

## **🔹 결론**

✅ **트리거(Trigger)**는 **특정 이벤트(INSERT, UPDATE, DELETE)가 발생하면 자동으로 실행되는 SQL 구문**입니다.

✅ **트리거는 데이터 무결성을 유지하고, 자동화된 로그 기록, 기본값 설정 등에 활용**됩니다.

✅ **시퀀스(Sequence)는 자동으로 증가하는 숫자를 생성하는 객체로, 주로 기본 키(PK) 값 자동 증가에 사용**됩니다.

✅ **MySQL에서는 `AUTO_INCREMENT`, Oracle/PostgreSQL에서는 `SEQUENCE`를 사용**합니다.
