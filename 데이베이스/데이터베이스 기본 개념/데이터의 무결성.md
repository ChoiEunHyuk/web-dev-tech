## **🔹 데이터 무결성(Data Integrity)란?**

- *데이터 무결성(Data Integrity)**은 **데이터의 정확성, 일관성, 신뢰성을 유지하는 것을 의미**합니다.

데이터베이스에서 잘못된 데이터가 입력되거나, 손상되지 않도록 **제약 조건(Constraints)**을 사용하여 보장합니다.

---

## **🔹 데이터 무결성의 종류**

데이터 무결성은 크게 **4가지 유형**으로 나뉩니다.

| **무결성 유형** | **설명** | **예제** |
| --- | --- | --- |
| **개체 무결성 (Entity Integrity)** | 각 행(Row)들이 고유하게 식별될 수 있어야 함. | `PRIMARY KEY` |
| **참조 무결성 (Referential Integrity)** | 외래 키(Foreign Key)로 연결된 테이블 간의 관계가 유지되어야 함. | `FOREIGN KEY` |
| **도메인 무결성 (Domain Integrity)** | 컬럼(Column)에 저장되는 데이터 유형과 값이 정의된 규칙을 따라야 함. | `CHECK`, `NOT NULL`, `DEFAULT` |
| **사용자 정의 무결성 (User-Defined Integrity)** | 특정 비즈니스 규칙에 따라 데이터가 저장되어야 함. | 특정 조건을 만족하는 값만 허용 |

---

## **🔹 1. 개체 무결성 (Entity Integrity)**

- **각 행(Row)이 고유해야 하며, NULL이 없어야 함.**
- 보통 **`PRIMARY KEY`를 사용하여 보장**함.

✅ **예제**

```sql
CREATE TABLE employees (
    emp_id INT PRIMARY KEY,  -- 고유한 직원 ID
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE
);

```

📌 **설명**

- `PRIMARY KEY`를 설정하면 **중복된 값 입력 불가**.
- `NOT NULL`을 설정하면 **NULL 값 입력 불가**.

🚨 **무결성 위반 예제**

```sql
INSERT INTO employees (emp_id, name, email) VALUES (1, 'Alice', 'alice@example.com');
INSERT INTO employees (emp_id, name, email) VALUES (1, 'Bob', 'bob@example.com');
-- ❌ 오류 발생 (emp_id 중복)

```

---

## **🔹 2. 참조 무결성 (Referential Integrity)**

- **외래 키(Foreign Key)를 사용하여, 관계가 올바르게 유지되도록 함.**
- 부모 테이블(Primary Key)과 자식 테이블(Foreign Key) 간의 관계를 보호.

✅ **예제**

```sql
CREATE TABLE departments (
    dept_id INT PRIMARY KEY,
    dept_name VARCHAR(100) NOT NULL
);

CREATE TABLE employees (
    emp_id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id) ON DELETE CASCADE
);

```

📌 **설명**

- `dept_id`가 **departments 테이블에 존재해야만** employees 테이블에 추가 가능.
- `ON DELETE CASCADE` → 부모 테이블의 `dept_id`가 삭제되면, 해당 부서의 직원들도 자동 삭제됨.

🚨 **무결성 위반 예제**

```sql
INSERT INTO employees (emp_id, name, dept_id) VALUES (101, 'Alice', 5);
-- ❌ 오류 발생 (departments 테이블에 dept_id = 5가 없음)

```

---

## **🔹 3. 도메인 무결성 (Domain Integrity)**

- **컬럼에 저장될 수 있는 값의 유형과 범위를 제한하여 보장.**
- `CHECK`, `DEFAULT`, `NOT NULL` 등의 제약 조건 사용.

✅ **예제**

```sql
CREATE TABLE products (
    product_id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) CHECK (price > 0),  -- 가격은 0보다 커야 함
    stock INT DEFAULT 0 CHECK (stock >= 0)  -- 재고는 음수가 될 수 없음
);

```

📌 **설명**

- `CHECK (price > 0)` → 가격이 **음수 값이 되지 않도록 제한**.
- `DEFAULT 0` → 기본적으로 재고(stock)를 0으로 설정.
- `CHECK (stock >= 0)` → 재고(stock)가 **음수가 되면 오류 발생**.

🚨 **무결성 위반 예제**

```sql
INSERT INTO products (product_id, name, price, stock) VALUES (1, 'Laptop', -500, 10);
-- ❌ 오류 발생 (price가 0보다 작을 수 없음)

```

---

## **🔹 4. 사용자 정의 무결성 (User-Defined Integrity)**

- **비즈니스 규칙에 따라 특정 데이터를 제한하는 방법.**
- 트리거(Trigger)나 저장 프로시저(Stored Procedure)를 사용하여 적용할 수 있음.

✅ **예제 (직원의 급여는 30만 원 이상이어야 함)**

```sql
CREATE TRIGGER check_salary
BEFORE INSERT ON employees
FOR EACH ROW
BEGIN
    IF NEW.salary < 300000 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Salary must be at least 300000';
    END IF;
END;

```

📌 **설명**

- 직원의 급여가 **30만 원 미만이면 삽입을 차단**하는 트리거.

🚨 **무결성 위반 예제**

```sql
INSERT INTO employees (emp_id, name, salary) VALUES (1, 'Alice', 250000);
-- ❌ 오류 발생 (Salary must be at least 300000)

```

---

## **🔹 무결성 제약 조건 정리**

| **제약 조건** | **설명** |
| --- | --- |
| **PRIMARY KEY** | 개체 무결성을 유지 (중복 불가, NULL 값 불가) |
| **FOREIGN KEY** | 참조 무결성을 유지 (부모 테이블 존재 여부 확인) |
| **CHECK** | 도메인 무결성을 유지 (값의 범위 제한) |
| **NOT NULL** | 도메인 무결성을 유지 (NULL 값 입력 방지) |
| **UNIQUE** | 중복된 값 입력 방지 |
| **DEFAULT** | 기본값을 자동으로 설정 |
| **TRIGGER** | 사용자 정의 무결성 적용 (특정 조건 만족 시 실행) |

---

## **🔹 데이터 무결성 위반 사례**

🚨 **1. 개체 무결성 위반**

```sql
INSERT INTO users (id, name) VALUES (NULL, 'Alice');
-- ❌ PRIMARY KEY는 NULL을 허용하지 않음.

```

🚨 **2. 참조 무결성 위반**

```sql
INSERT INTO employees (emp_id, name, dept_id) VALUES (101, 'Alice', 5);
-- ❌ departments 테이블에 dept_id = 5가 없으면 오류 발생.

```

🚨 **3. 도메인 무결성 위반**

```sql
INSERT INTO products (product_id, name, price) VALUES (1, 'Laptop', -1000);
-- ❌ CHECK(price > 0) 제약 조건 위반.

```

🚨 **4. 사용자 정의 무결성 위반**

```sql
INSERT INTO employees (emp_id, name, salary) VALUES (1, 'Bob', 250000);
-- ❌ 트리거에 의해 최소 급여 제한 위반.

```

---

## **🔹 결론**

✅ **데이터 무결성(Data Integrity)은 데이터의 정확성, 일관성, 신뢰성을 보장하는 개념**.

✅ **4가지 주요 무결성 원칙**(개체 무결성, 참조 무결성, 도메인 무결성, 사용자 정의 무결성)을 통해 데이터 보호.

✅ **PRIMARY KEY, FOREIGN KEY, CHECK, NOT NULL, UNIQUE 등의 제약 조건을 사용하여 무결성을 유지**.

✅ **무결성이 깨지면 데이터 오류가 발생하고, 이를 방지하기 위해 제약 조건과 트랜잭션을 적절히 활용해야 함**.
